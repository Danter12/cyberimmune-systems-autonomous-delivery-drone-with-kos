# Решение

Данный репозиторий являестя решением квалификационной задачи, который состоит из настройки и запуска цифрова двойника, а также вывода координат и высоты местоположения квадрокоптера в данный момент.

## Настройка и запуск цифрового двойника

Цифровой двойник настраивали на Ubuntu 22.04 при помощи Docker контейнеров.

Для того чтобы запустить цифровой двойник, нужно сначала подготовить свою linux систему.

### Установка пакетов

```bash
# Получение информации о свежих версиях пакетов для дистрибутива
sudo apt-get update

# Установка необходимых пакетов
sudo apt-get install -y git make docker-compose docker.io libfuse2

# Удаление ненужных пакетов
sudo apt-get remove modemmanager -y

# Добавления пользователя user в нужные группы
sudo usermod -aG sudo,docker,dialout username

# Клонирование репозитория с симулятором
git clone https://github.com/Danter12/cyberimmune-systems-autonomous-delivery-drone-with-kos.git

# Размещение KasperskyOS CE SDK 1.2 в папке проекта (копия репозитория)
cp ~/Downloads/KasperskyOS-Community-Edition-1.2.0.45.zip cyberimmune-systems-autonomous-delivery-drone-with-kos/
```
#### Запуск :

```bash
# Запуск контейнеров с ОРВД, SITL симулятором, компонентом на KasperskyOS, планировщиком MAVProxy
cd cyberimmune-systems-autonomous-delivery-drone-with-kos
make online
```

### Запуск APM Planner 2

В новом терминале:

```bash
cd planner/
./APM_Planner.AppImage
```

### Работа c APM Planner 2 и ОРВД

После того как виртуальный квадракоптер появиться в APM Planner 2, можно загрузить полетную миссию и считать её. Для этого нужно перейти на вкладку FLIGT PLAN, однако без утверждения этой миссии в ОРВД квадракоптер не сможет взлететь. Заходим в браузер и переходим на локальный хост. Входим в ОРВД ,введя логин: admin и пороль: passw. Переходим в Missioner sender, вводим ID 2 и загружаем полетную миссию из папки ardupilot и отправлем её на ОРВД. Затем подтвердаем миссию в ОРВД. После этого открываем планировщик, нажимаем на ARM, после чего квадракоптер отправлетя запрос на ОРВД. Затем в систем ОРВД нажимаем на кнопку ARM, после того как появится дрон в ожидании, опять переходим в планировщик нажимаем на ARM, квадракоптер запускается, ставим режим на выполнение миссии и запускаем миссию.

## Вывод координат и высоты местоположения квадрокоптера в данный момент

Для того чтобы в консоле выводились координаты и высота нам нужно отредактировать файл `kos/flight_controller/src/main.cpp`.

### Код

в конце файла добавляем:

```C
while (true)
{
fprintf(stderr,"»»»»»»>\n");
int32_t x,y,z;
getCoords(x,y,z);
fprintf(stderr,"latitude:[%d] longitude:[%d] altitude: [%d]\n",x,y,z);
sleep(1);
}
```
getCoords(x,y,z) - функция, которая записывает в перменные текущие координты квадракоптера.

### Проверка программы

Запускаем цифровой двойник через сквозные тесты:
```bash
make e2e-offline
```
Во время выполнения миссии, в консоль будет выводиться следующее:

```
waypoint 1
»»»»»»>
latitude:[531019445] longitude:[1073774394] altitude: [84628]
»»»»»»>
.......
